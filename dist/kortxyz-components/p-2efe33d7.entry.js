import{r as t,h as e,g as i,H as s,c as n}from"./p-f4ecfe08.js";import{c as o}from"./p-3e8ff66b.js";function r(){}r.prototype.init=function(){if(!arguments.length)throw new Error("no arguments");if(arguments[0].lat&&arguments[0].lng)this.lat=arguments[0].lat,this.lon=arguments[0].lng;else if("string"==typeof arguments[0]){var t=arguments[0].split(",");this.lat=parseFloat(t[0].trim()),this.lon=parseFloat(t[1].trim())}else if("[object Array]"===Object.prototype.toString.call(arguments[0])){var e=arguments[0];!0===arguments[1]?(this.lat=e[1],this.lon=e[0]):(this.lat=e[0],this.lon=e[1])}else!0===arguments[2]?(this.lat=arguments[1],this.lon=arguments[0]):(this.lat=arguments[0],this.lon=arguments[1]);this.compute()},r.prototype.compute=function(){function t(t){var e={};return e.initValue=t,e.degrees=Math.abs(t),e.degreesInt=Math.floor(e.degrees),e.degreesFrac=e.degrees-e.degreesInt,e.secondsTotal=3600*e.degreesFrac,e.minutes=e.secondsTotal/60,e.minutesInt=Math.floor(e.minutes),e.seconds=e.secondsTotal-60*e.minutesInt,e}this.north=this.lat>0,this.east=this.lon>0,this.latValues=t(this.lat),this.lonValues=t(this.lon)};var h={FFf:"DD MM ss X",Ff:"DD mm X",f:"dd X"};r.prototype.format=function(t,e){"object"==typeof t&&(e=t,t="FFf"),void 0===t&&(t="FFf"),void 0===e&&(e={}),"string"==typeof e&&(e={latLonSeparator:e}),void 0===e.latLonSeparator&&(e.latLonSeparator=" "),e.decimalPlaces=void 0===e.decimalPlaces?5:parseInt(e.decimalPlaces),Object.keys(h).indexOf(t)>-1&&(t=h[t]);var i=n(this.latValues,this.north?"N":"S"),s=n(this.lonValues,this.east?"E":"W");function n(i,s){var n=t;return(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=n.replace(/DD/g,i.degreesInt+"°")).replace(/dd/g,i.degrees.toFixed(e.decimalPlaces)+"°")).replace(/D/g,i.degreesInt)).replace(/d/g,i.degrees.toFixed(e.decimalPlaces))).replace(/MM/g,i.minutesInt+"′")).replace(/mm/g,i.minutes.toFixed(e.decimalPlaces)+"′")).replace(/M/g,i.minutesInt)).replace(/m/g,i.minutes.toFixed(e.decimalPlaces))).replace(/ss/g,i.seconds.toFixed(e.decimalPlaces)+"″")).replace(/s/g,i.seconds.toFixed(e.decimalPlaces))).replace(/-/g,i.initValue<0?"-":"")).replace(/X/g,s)}return i+e.latLonSeparator+s};const l=class{constructor(e){t(this,e)}handleScroll(t){this.coordinatesEl.innerHTML=function(){var t=new r;return t.init.apply(t,arguments),t}(t.detail.center,!0).format("f")}render(){return e(s,null)}get coordinatesEl(){return i(this)}};l.style="kortxyz-coordinates{height:100%;padding:0 20px 0 20px;display:flex;justify-content:center;font-family:'Roboto Mono', monospace;font-size:10px;line-height:20px;color:#ddd;cursor:pointer}kortxyz-coordinates:hover{background:#dddddd29}";const u=class{constructor(e){t(this,e)}render(){return[e("filler",null),e("kortxyz-coordinates",null),e("kortxyz-gps",null),e("filler",null)]}get footerEl(){return i(this)}};u.style="kortxyz-footer{height:100%;width:100%;display:flex;flex-direction:row;flex:1;background:#007ACC}kortxyz-footer>filler{flex:1}";const c=class{constructor(e){t(this,e),this.mapMoved=n(this,"mapMoved",7),this.state="gps_off",this.onPosition=t=>{this.mapMoved.emit({center:[t.coords.longitude,t.coords.latitude]})}}notFixed(){"gps_fixed"==this.state&&(this.stopGPS(),this.state="gps_not_fixed",this.icon.innerHTML=this.state)}stopGPS(){navigator.geolocation.clearWatch(this.navigator)}startGPS(){this.navigator=navigator.geolocation.watchPosition(this.onPosition,(t=>console.error(t)),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}toogle(){"gps_fixed"!=this.state?(this.state="gps_fixed",this.startGPS()):(this.state="gps_off",this.stopGPS()),this.icon.innerHTML=this.state}render(){return[e("i",{class:"material-icons",ref:t=>this.icon=t,onClick:()=>this.toogle()},"gps_off")]}get gpsEl(){return i(this)}};c.style="kortxyz-gps{height:100%;display:flex;width:20px;justify-content:center}kortxyz-gps>.material-icons{color:#ddd;font-size:12px;line-height:20px}kortxyz-gps>.material-icons:hover{color:rgb(255, 255, 255)}";const a=class{constructor(e){t(this,e),this.closed=!0,this.onClick=t=>{const e=t.target.parentElement.getAttribute("content");e&&(this.activecontent?this.activecontent==e?this.close(e):this.activecontent!=e&&(this.close(this.activecontent),this.open(e)):this.open(e))},this.doResize=t=>{t.clientX<240||t.clientX>740||(this.sidebarEl.style.flex="0 0 "+t.clientX+"px")},this.initResize=()=>{document.body.style.cursor="e-resize",window.addEventListener("mousemove",this.doResize,!1),window.addEventListener("mouseup",this.stopResize,!1)},this.stopResize=()=>{document.body.style.cursor="",window.removeEventListener("mousemove",this.doResize,!1),window.removeEventListener("mouseup",this.stopResize,!1)}}open(t){this.closed=!1,document.querySelector(`kortxyz-sideitem[content='${t}']`).classList.add("active");const e=document.createElement(t);this.sidebarEl.querySelector("contents").append(e),this.activecontent=t}close(t){this.closed=!0;const e=document.querySelector(`kortxyz-sideitem[content='${t}']`);console.log(t,e),e.classList.remove("active"),this.sidebarEl.querySelector("contents>"+this.activecontent).remove(),this.activecontent=""}componentDidLoad(){this.activecontent&&this.open(this.activecontent)}render(){return e(s,{class:{closed:this.closed}},e("icons",{onClick:t=>this.onClick(t)},e("slot",null)),e("contents",null),e("resizer",{onMouseDown:()=>this.initResize()}))}get sidebarEl(){return i(this)}};a.style="kortxyz-sidebar{height:100%;display:flex;flex:0 0 340px;background:#252526}kortxyz-sidebar.closed{flex:0 0 40px !important}kortxyz-sidebar>icons{background:#333333;flex:0 0 40px;display:flex;flex-direction:column}kortxyz-sidebar>contents{flex:1;display:flex}kortxyz-sidebar>resizer{flex:0 0 4px;cursor:w-resize}";const f=class{constructor(e){t(this,e),this.icon="face"}render(){return[e("i",{class:"material-icons"},this.icon)]}get sideitemEl(){return i(this)}};f.style="kortxyz-sideitem{height:40px;width:100%;display:flex;user-select:none}kortxyz-sideitem:hover>.material-icons{color:#eee}kortxyz-sideitem.active::before{content:'';width:2px;height:40px;background:#eee;position:absolute}kortxyz-sideitem.active>.material-icons{color:#eee}kortxyz-sideitem>.material-icons{width:100%;cursor:pointer;font-size:20px;justify-content:center;line-height:40px;display:flex;color:#858585}";var d=o((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});const i=new WeakMap,s=new WeakMap;function n(t){const e=i.get(t);return console.assert(null!=e,"'this' is expected an Event object, but got",t),e}function o(t,e){i.set(this,{eventTarget:t,event:e,eventPhase:2,currentTarget:t,canceled:!1,stopped:!1,passiveListener:null,timeStamp:e.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const s=Object.keys(e);for(let t=0;t<s.length;++t){const e=s[t];e in this||Object.defineProperty(this,e,r(e))}}function r(t){return{get(){return n(this).event[t]},set(e){n(this).event[t]=e},configurable:!0,enumerable:!0}}function h(t){return{value(){const e=n(this).event;return e[t].apply(e,arguments)},configurable:!0,enumerable:!0}}function l(t){if(null==t||t===Object.prototype)return o;let e=s.get(t);return null==e&&(e=function(t,e){const i=Object.keys(e);if(0===i.length)return t;function s(e,i){t.call(this,e,i)}s.prototype=Object.create(t.prototype,{constructor:{value:s,configurable:!0,writable:!0}});for(let n=0;n<i.length;++n){const o=i[n];if(!(o in t.prototype)){const t=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(s.prototype,o,"function"==typeof t.value?h(o):r(o))}}return s}(l(Object.getPrototypeOf(t)),t),s.set(t,e)),e}function u(t){return n(t).stopped}function c(t,e){n(t).passiveListener=e}o.prototype={get type(){return n(this).event.type},get target(){return n(this).eventTarget},get currentTarget(){return n(this).currentTarget},composedPath(){const t=n(this).currentTarget;return null==t?[]:[t]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return n(this).eventPhase},stopPropagation(){const t=n(this);"function"==typeof t.event.stopPropagation&&t.event.stopPropagation()},stopImmediatePropagation(){const t=n(this);t.stopped=!0,"function"==typeof t.event.stopImmediatePropagation&&t.event.stopImmediatePropagation()},get bubbles(){return Boolean(n(this).event.bubbles)},get cancelable(){return Boolean(n(this).event.cancelable)},preventDefault(){const t=n(this);null==t.passiveListener?t.event.cancelable&&(t.canceled=!0,"function"==typeof t.event.preventDefault&&t.event.preventDefault()):console.warn("Event#preventDefault() was called from a passive listener:",t.passiveListener)},get defaultPrevented(){return n(this).canceled},get composed(){return Boolean(n(this).event.composed)},get timeStamp(){return n(this).timeStamp}},Object.defineProperty(o.prototype,"constructor",{value:o,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(o.prototype,window.Event.prototype),s.set(window.Event.prototype,o));const a=new WeakMap;function f(t){return null!==t&&"object"==typeof t}function d(t){const e=a.get(t);if(null==e)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return e}function p(t,e){Object.defineProperty(t,"on"+e,function(t){return{get(){let e=d(this).get(t);for(;null!=e;){if(3===e.listenerType)return e.listener;e=e.next}return null},set(e){"function"==typeof e||f(e)||(e=null);const i=d(this);let s=null,n=i.get(t);for(;null!=n;)3===n.listenerType?null!==s?s.next=n.next:null!==n.next?i.set(t,n.next):i.delete(t):s=n,n=n.next;if(null!==e){const n={listener:e,listenerType:3,passive:!1,once:!1,next:null};null===s?i.set(t,n):s.next=n}},configurable:!0,enumerable:!0}}(e))}function g(t){function e(){m.call(this)}e.prototype=Object.create(m.prototype,{constructor:{value:e,configurable:!0,writable:!0}});for(let i=0;i<t.length;++i)p(e.prototype,t[i]);return e}function m(){if(!(this instanceof m)){if(1===arguments.length&&Array.isArray(arguments[0]))return g(arguments[0]);if(arguments.length>0){const t=new Array(arguments.length);for(let e=0;e<arguments.length;++e)t[e]=arguments[e];return g(t)}throw new TypeError("Cannot call a class as a function")}a.set(this,new Map)}m.prototype={addEventListener(t,e,i){if(null==e)return!1;if("function"!=typeof e&&!f(e))throw new TypeError("'listener' should be a function or an object.");const s=d(this),n=f(i),o=(n?Boolean(i.capture):Boolean(i))?1:2,r={listener:e,listenerType:o,passive:n&&Boolean(i.passive),once:n&&Boolean(i.once),next:null};let h=s.get(t);if(void 0===h)return s.set(t,r),!0;let l=null;for(;null!=h;){if(h.listener===e&&h.listenerType===o)return!1;l=h,h=h.next}return l.next=r,!0},removeEventListener(t,e,i){if(null==e)return!1;const s=d(this),n=(f(i)?Boolean(i.capture):Boolean(i))?1:2;let o=null,r=s.get(t);for(;null!=r;){if(r.listener===e&&r.listenerType===n)return null!==o?o.next=r.next:null!==r.next?s.set(t,r.next):s.delete(t),!0;o=r,r=r.next}return!1},dispatchEvent(t){if(null==t||"string"!=typeof t.type)throw new TypeError('"event.type" should be a string.');const e=d(this),i=t.type;let s=e.get(i);if(null==s)return!0;const o=function(t,e){return new(l(Object.getPrototypeOf(e)))(t,e)}(this,t);let r=null;for(;null!=s;){if(s.once?null!==r?r.next=s.next:null!==s.next?e.set(i,s.next):e.delete(i):r=s,c(o,s.passive?s.listener:null),"function"==typeof s.listener)try{s.listener.call(this,o)}catch(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t)}else 3!==s.listenerType&&"function"==typeof s.listener.handleEvent&&s.listener.handleEvent(o);if(u(o))break;s=s.next}return c(o,null),function(t){n(t).eventPhase=0}(o),function(t){n(t).currentTarget=null}(o),!o.defaultPrevented}},Object.defineProperty(m.prototype,"constructor",{value:m,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(m.prototype,window.EventTarget.prototype),e.defineEventAttribute=p,e.EventTarget=m,e.default=m,t.exports=m,t.exports.EventTarget=t.exports.default=m,t.exports.defineEventAttribute=p}));class p{constructor(t){this.endpoint=t.endpoint,this.file=t.file,this.headers=t.headers||{},this.postParams=t.postParams,this.chunkSize=t.chunkSize||10,this.retries=t.retries||5,this.delayBeforeRetry=t.delayBeforeRetry||5,this.start=0,this.chunk=null,this.chunkCount=0,this.totalChunks=Math.ceil(this.file.size/(1e3*this.chunkSize*1e3)),this.retriesCount=0,this.offline=!1,this.paused=!1,this.headers["uploader-file-id"]=this._uniqid(this.file),this.headers["uploader-chunks-total"]=this.totalChunks,this._reader=new FileReader,this._eventTarget=new d.EventTarget,this._validateParams(),this._sendChunks(),window.addEventListener("online",(()=>{this.offline&&(this.offline=!1,this._eventTarget.dispatchEvent(new Event("online")),this._sendChunks())})),window.addEventListener("offline",(()=>{this.offline=!0,this._eventTarget.dispatchEvent(new Event("offline"))}))}on(t,e){this._eventTarget.addEventListener(t,e)}_validateParams(){if(!this.endpoint||!this.endpoint.length)throw new TypeError("endpoint must be defined");if(this.file instanceof File==0)throw new TypeError("file must be a File object");if(this.headers&&"object"!=typeof this.headers)throw new TypeError("headers must be null or an object");if(this.postParams&&"object"!=typeof this.postParams)throw new TypeError("postParams must be null or an object");if(this.chunkSize&&("number"!=typeof this.chunkSize||0===this.chunkSize))throw new TypeError("chunkSize must be a positive number");if(this.retries&&("number"!=typeof this.retries||0===this.retries))throw new TypeError("retries must be a positive number");if(this.delayBeforeRetry&&"number"!=typeof this.delayBeforeRetry)throw new TypeError("delayBeforeRetry must be a positive number")}_uniqid(){return Math.floor(1e8*Math.random())+Date.now()+this.file.size}_getChunk(){return new Promise((t=>{const e=1===this.totalChunks?this.file.size:1e3*this.chunkSize*1e3,i=e*this.chunkCount;this._reader.onload=()=>{this.chunk=new Blob([this._reader.result],{type:"application/octet-stream"}),t()},this._reader.readAsArrayBuffer(this.file.slice(i,i+e))}))}_sendChunk(){const t=new FormData;return this.chunkCount+1===this.totalChunks&&this.postParams&&Object.keys(this.postParams).forEach((e=>t.append(e,this.postParams[e]))),t.append("file",this.chunk),this.headers["uploader-chunk-number"]=this.chunkCount,fetch(this.endpoint,{method:"POST",headers:this.headers,body:t})}_manageRetries(){if(this.retriesCount++<this.retries)return setTimeout((()=>this._sendChunks()),1e3*this.delayBeforeRetry),void this._eventTarget.dispatchEvent(new CustomEvent("fileRetry",{detail:{message:`An error occured uploading chunk ${this.chunkCount}. ${this.retries-this.retriesCount} retries left`,chunk:this.chunkCount,retriesLeft:this.retries-this.retriesCount}}));this._eventTarget.dispatchEvent(new CustomEvent("error",{detail:`An error occured uploading chunk ${this.chunkCount}. No more retries, stopping upload`}))}_sendChunks(){this.paused||this.offline||this._getChunk().then((()=>this._sendChunk())).then((t=>{if(200===t.status||201===t.status||204===t.status){++this.chunkCount<this.totalChunks?this._sendChunks():this._eventTarget.dispatchEvent(new Event("finish"));const t=Math.round(100/this.totalChunks*this.chunkCount);this._eventTarget.dispatchEvent(new CustomEvent("progress",{detail:t}))}else if([408,502,503,504].includes(t.status)){if(this.paused||this.offline)return;this._manageRetries()}else{if(this.paused||this.offline)return;this._eventTarget.dispatchEvent(new CustomEvent("error",{detail:`Server responded with ${t.status}. Stopping upload`}))}})).catch((()=>{this.paused||this.offline||this._manageRetries()}))}togglePause(){this.paused=!this.paused,this.paused||this._sendChunks()}}const g=class{constructor(e){t(this,e),this.uploadStatus=n(this,"uploadStatus",7),this.url="http://localhost:4444/collections"}upload(t){t.target.files.length>0&&[...t.target.files].forEach((t=>{const e=new p({endpoint:this.url,file:t,postParams:{name:t.name,group:"uploads"}});e.on("error",(t=>this.uploadStatus.emit({code:"error",value:t.detail}))),e.on("progress",(t=>this.uploadStatus.emit({code:"progress",value:t.detail}))),e.on("finish",(t=>this.uploadStatus.emit({code:"progress",value:t.detail})))}))}render(){return[e("input",{multiple:!0,type:"file",name:"file",id:"file",onChange:t=>this.upload(t)})]}get dropzoneEl(){return i(this)}};g.style="kortxyz-uploader{height:100%;width:100%;display:flex;flex:1}";export{l as kortxyz_coordinates,u as kortxyz_footer,c as kortxyz_gps,a as kortxyz_sidebar,f as kortxyz_sideitem,g as kortxyz_uploader}