import{r as t,h as s,g as o}from"./p-f4ecfe08.js";import"./p-3e8ff66b.js";import{s as e,a as i,r as a}from"./p-4bfc283d.js";const r=class{constructor(s){t(this,s)}async setActiveTab(t){this.activetab&&this.tabs.children[this.activetab]&&(this.tabs.children[this.activetab].active=!1,this.contents.children[this.activetab].style.display="none"),this.activetab=t.id,t.active=!0,this.contents.children[t.id].style.display="flex"}async getActiveTab(){return this.tabs.children[this.activetab]}async addCollectionTab(t,s=null){s||0===s||(s=this.tabs.childElementCount-1);const o=(new Date).getTime();let i=document.createElement("kortxyz-tab");i.id=o,i.icon="layers",i.name=t.name,i.collection=t,this.tabs.insertBefore(i,this.tabs.children[s]);let a=document.createElement("kortxyz-mapbox");a.id=o,a.mapstyle=e(t),a.bbox=t.extent.spatial,this.contents.append(a),this.setActiveTab(i),document.querySelectorAll("kortxyz-mapbox").forEach((t=>{t.inFocus=!1}))}async addFileTab(t,s,o=null){o||0===o||(o=this.tabs.childElementCount-1);const e=(new Date).getTime();let a=document.createElement("kortxyz-tab");a.id=e,a.name=t,a.icon="description",this.tabs.insertBefore(a,this.tabs.children[o]);let r=document.createElement("kortxyz-mapbox");r.id=e,r.mapstyle=i(s),r.bbox=r.mapstyle.sources.test.bounds,this.contents.append(r),this.setActiveTab(a),document.querySelectorAll("kortxyz-mapbox").forEach((t=>{t.inFocus=!1}))}async removeTab(t){let s=this.contents.childElementCount;if(t.active&&s>1&&this.setActiveTab(t.nextElementSibling.droparea?t.previousElementSibling:t.nextElementSibling),t.remove(),this.contents.children[t.id].remove(),1==s){const t=this.tabbarEl.parentElement;if("KORTXYZ-SPLITVIEW"==t.tagName){const s="first"==this.tabbarEl.slot?this.tabbarEl.nextElementSibling:this.tabbarEl.previousElementSibling,o="first"==this.tabbarEl.slot?s.nextElementSibling:s.previousElementSibling;this.tabbarEl.remove(),s.remove(),t.parentElement.firstChild==t?t.parentElement.prepend(o):t.parentElement.append(o),t.remove(),document.querySelectorAll("kortxyz-mapbox").forEach((t=>t.initResizeObsersver()))}}document.querySelectorAll("kortxyz-mapbox").forEach((t=>{t.inFocus=!1}))}async onDrop(t){document.querySelectorAll("kortxyz-tab").forEach((t=>t.style.background=""));const s=t.target.parentElement,o=[...s.parentElement.children].findIndex((t=>t.id==s.id)),e=t.dataTransfer.files;if(e.length>0)(await a(e)).forEach((t=>{this.addFileTab(t.name,t.data,o)}));else{const s=t.dataTransfer.getData("text/plain");let e;try{e=JSON.parse(s)}catch(t){console.error(t)}"tab"==e.type&&(this.addCollectionTab(e.data.collection,o),document.querySelector("#"+CSS.escape(e.data.id)).removeTab()),"collection"==e.type&&this.addCollectionTab(e.data.collection,o)}}render(){return[s("tabs",{ref:t=>this.tabs=t,ondrop:t=>this.onDrop(t)},s("kortxyz-tab",{droparea:!0})),s("contents",{ref:t=>this.contents=t,ondrop:t=>this.onDrop(t)})]}get tabbarEl(){return o(this)}};r.style="kortxyz-tabbar{height:100%;width:100%;display:flex;flex:1;flex-direction:column}kortxyz-tabbar>tabs{background:#252526;flex:0 0 30px;display:flex;overflow:auto;max-width:100%;flex-wrap:wrap}kortxyz-tabbar>contents{flex:1}kortxyz-tabbar>contents>*{display:none}kortxyz-tabbar>contents>*{display:none}i{cursor:pointer}";export{r as kortxyz_tabbar}